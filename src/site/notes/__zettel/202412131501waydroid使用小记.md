---
{"dg-publish":true,"permalink":"/__zettel/202412131501waydroid使用小记/","title":202412131501,"tags":["waydroid","android","linux","container","安卓","容器"],"created":"2024-12-13T15:01:47+08:00"}
---

[Waydroid][2]是一款可以在linux体内跑android的容器。不同于虚拟机，它利用容器化技术直接在Linux启动android系统，性能比虚拟机要好得多。目前仅支持[Wayland](https://wayland.freedesktop.org/) session. 但通过在X session中使用一些compositor也能跑起来。

顺便说下，waydroid数据目录：`/home/yychi/.local/share/waydroid/data`. 

使用指南主要参考archwiki.

![](/img/user/assets/image-20241213171336896.png)

- 与host共享文件夹，参考[此处][3]。
- 安装[smartdock][4]（一个类似桌面端的launcher）

Troubleshooting
---

### Android容器内无网络

> [!note]
> Android内部快捷菜单中的wifi按钮开关是假的，没有任何意义。即，无论它的状态是啥跟容器内部有无网络连接无关！

- 确保开启iptables和dnsmasq，使用`systemctl status <xxx>`查看状态
- `/usr/lib/waydroid/data/scripts/waydroid-net.sh`脚本配置问题，参考这个[issue][1]

### Arm安装包安装失败

由于waydroid的架构和宿主（host）一致，一般是x86_64. 所以为arm架构编译的apk会安装失败。可以尝试[casualsnek](https://github.com/casualsnek/waydroid_script)的脚本[^a]。

这里仅提两个坑点：

- 上面的脚本指导使用python虚拟环境安装依赖包，但是他又要调用waydroid的系统脚本（依赖dbus-python），而且还要sudo权限，sudo完之后很多包会找不到，不如一开始就用系统环境用sudo安装依赖。
- 大陆用户可能受网络问题困扰，终端设置ALL_PROXY不再生效，可能是request包不读这个环境变量。我的做法是，直接浏览器下载好放到指定位置，改改代码跳过校5，直接安装。

References
---

1. [Script to start Android LineageOS with Waydroid in an X11 session](https://unix.stackexchange.com/questions/732485/script-to-start-android-lineageos-with-waydroid-in-an-x11-session)
2. [No internet in waydroid](https://github.com/waydroid/waydroid/issues/143)

[^a]: 这里参考[archwiki][2].

[1]: https://github.com/waydroid/waydroid/issues/143#issuecomment-1520857943
[2]: https://wiki.archlinux.org/title/Waydroid
[3]: https://docs.waydro.id/faq/setting-up-a-shared-folder
[4]: https://f-droid.org/zh_Hans/packages/cu.axel.smartdock/