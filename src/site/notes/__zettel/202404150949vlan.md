---
{"dg-publish":true,"permalink":"/zettel/202404150949vlan/","title":202404150949,"tags":["vlan","vxlan"],"created":"2024-04-15T09:49:33+08:00"}
---


Vlan和Vxlan
===

Vlan（Virtual LAN）
---

为什么需要Vlan？

在二层网络（Data Link Layer）中，交换机本身就是一个广播域。如果不划分Vlan，任意一台连接到交换机上的设备所发送的报文，将会广播给其他所有的设备。

如果设备太多，过多的封包将会拥塞网络。

  

每一个Vlan都相当于一个广播域。不同的Vlan之间想要通讯就必须要通过第三层网络（Network Layer）。

二层交换机可以划分出很多的Vlan，但是Vlan间的通信必须要加上路由器。然而，三层交换机包含了路由功能。相当于二层交换机+路由器。

  

Access口：用于接入设备

Trunk口：连接其他的交换机，上面可以承载多个Vlan

![](assets/202404150949vlan/image-20240415095345611.png)

| 16 bits | 3 bits | 1 bit | 12 bits |
| ------- | ------ | ----- | ------- |
| TPID    | PCP    | CFI   | VID     |

因为只有12位 Vlan Identifier， 所以可用的Vlan只有4096-2 = 4094个

4094个Vlan 对于大型云计算需要的隔离性是不够的，所以需要Vxlan

  

Vxlan（virtual extensible lan）
---

  

Vxlan 有24bit 标识位， 满足庞大的隔离需求。而且提供无障碍接入的网络。
![](http://image.huawei.com/tiny-lts/v1/images/dd5f3252408f966403baaa0b892cb854_579x459.png@900-0-90-f.png)  
  

  

虚拟机动态迁移：将一个虚拟机从一个物理服务器迁移到另一物理服务器。要求IP地址，运行状态不变，只能在一个二层域迁移。

传统架构限制了迁移的范围

![](http://image.huawei.com/tiny-lts/v1/images/b2f686918f03f7ffd6c81cf796f4c340_456x384.png@900-0-90-f.png)

  

Vxlan技术基于三层的网络结构，构建了二层的虚拟网络  
  

![](http://image.huawei.com/tiny-lts/v1/images/806bc0104d34dffdf34157c7286ae94d_648x310.png@900-0-90-f.png)

  

  
  

Vxlan是一种overlay技术，overlay是基于隧道技术实现的。Vxlan把原始二层报文进行隧道协议封装之后，在承载网络中透明传输，完全无视中间网络的结构。中间的网络就像一个巨大的交换机，主机毫不关心报文在交换机中是如何传输的。

Reference
---

1. https://zh.wikipedia.org/zh-cn/IEEE_802.1Q