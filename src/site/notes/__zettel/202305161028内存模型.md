---
{"dg-publish":true,"permalink":"/__zettel/202305161028内存模型/","title":202305161028,"tags":["cpp","memory-model","memory-order","memory-barrier","内存序"],"created":"2023-05-16T10:28:29+08:00"}
---


为什么需要内存模型
------------------------------------

编译器会优化代码，会在不影响正确结果的前提下，调整代码执行顺序，此外cpu也会乱序执行，提高效率。所以，你的代码跑起来未必是按照你写的顺序执行的。这在单线程环境下毫无问题，一旦进入多线程，这种乱序会带来不可预期的结果。

因此，我们需要一种方式来（向底层：编译器）控制，告诉，声明我这段代码必须要按顺序执行。内存模型应运而生。

此外，还有

> [!NOTE] Cache coherency
> 现代cpu拥有多级cache，其中cache是有访问权限的。有些cahce中的数据只能被一个核心看到，这在多线程访问数据时就会出现很大的问题。

例如：

<style> .container {font-family: sans-serif; text-align: center;} .button-wrapper button {z-index: 1;height: 40px; width: 100px; margin: 10px;padding: 5px;} .excalidraw .App-menu_top .buttonList { display: flex;} .excalidraw-wrapper { height: 800px; margin: 50px; position: relative;} :root[dir="ltr"] .excalidraw .layer-ui__wrapper .zen-mode-transition.App-menu_bottom--transition-left {transform: none;} </style><script src="https://cdn.jsdelivr.net/npm/react@17/umd/react.production.min.js"></script><script src="https://cdn.jsdelivr.net/npm/react-dom@17/umd/react-dom.production.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@excalidraw/excalidraw@0/dist/excalidraw.production.min.js"></script><div id="cache-coherencyexcalidraw.md1"></div><script>(function(){const InitialData={"type":"excalidraw","version":2,"source":"https://github.com/zsviczian/obsidian-excalidraw-plugin/releases/tag/2.7.1","elements":[{"type":"rectangle","version":263,"versionNonce":1597686196,"isDeleted":false,"id":"2obJnozdgySbJp3sxTH4M","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":1,"opacity":100,"angle":0,"x":-140,"y":-100,"strokeColor":"#000000","backgroundColor":"transparent","width":217,"height":113,"seed":270569298,"groupIds":[],"roundness":{"type":3},"boundElements":[{"type":"text","id":"EZFJ5cmz"},{"id":"Zr7-kRtDOsCzCFMZwOs4t","type":"arrow"}],"updated":1734707177209,"link":null,"locked":false,"index":"a0","frameId":null},{"type":"text","version":219,"versionNonce":1477600140,"isDeleted":false,"id":"EZFJ5cmz","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":1,"opacity":100,"angle":0,"x":-81.14994812011719,"y":-95,"strokeColor":"#000000","backgroundColor":"transparent","width":99.29989624023438,"height":25,"seed":1358882032,"groupIds":[],"roundness":null,"boundElements":[],"updated":1734707177209,"link":null,"locked":false,"fontSize":20,"fontFamily":1,"text":"CPU Core1","rawText":"CPU Core1","textAlign":"center","verticalAlign":"top","containerId":"2obJnozdgySbJp3sxTH4M","originalText":"CPU Core1","lineHeight":1.25,"baseline":18,"autoResize":true,"index":"a1","frameId":null},{"type":"rectangle","version":384,"versionNonce":861956916,"isDeleted":false,"id":"GgZCPi-Ftl_nRy9voleLb","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":1,"opacity":100,"angle":0,"x":-180,"y":100,"strokeColor":"#000000","backgroundColor":"transparent","width":599,"height":40,"seed":2008470802,"groupIds":[],"roundness":{"type":3},"boundElements":[{"type":"text","id":"jbCW04Au"},{"id":"Zr7-kRtDOsCzCFMZwOs4t","type":"arrow"},{"id":"qK2BSuTEqi8ZAs2thpmmC","type":"arrow"}],"updated":1734707177209,"link":null,"locked":false,"index":"a2","frameId":null},{"type":"text","version":310,"versionNonce":26612236,"isDeleted":false,"id":"jbCW04Au","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":1,"opacity":100,"angle":0,"x":86.030029296875,"y":107.5,"strokeColor":"#000000","backgroundColor":"transparent","width":66.93994140625,"height":25,"seed":824167440,"groupIds":[],"roundness":null,"boundElements":[],"updated":1734707177209,"link":null,"locked":false,"fontSize":20,"fontFamily":1,"text":"memory","rawText":"memory","textAlign":"center","verticalAlign":"middle","containerId":"GgZCPi-Ftl_nRy9voleLb","originalText":"memory","lineHeight":1.25,"baseline":18,"autoResize":true,"index":"a3","frameId":null},{"type":"arrow","version":2370,"versionNonce":1071041972,"isDeleted":false,"id":"Zr7-kRtDOsCzCFMZwOs4t","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":1,"opacity":100,"angle":0,"x":-47.573292149938375,"y":15.179783950617292,"strokeColor":"#000000","backgroundColor":"transparent","width":1.7237290650041075,"height":82.42245370370368,"seed":670982866,"groupIds":[],"roundness":{"type":2},"boundElements":[],"updated":1734707177399,"link":null,"locked":false,"startBinding":{"elementId":"2obJnozdgySbJp3sxTH4M","gap":2.1797839506172885,"focus":0.13591943458454825},"endBinding":{"elementId":"GgZCPi-Ftl_nRy9voleLb","gap":2.3977623456790145,"focus":-0.56437187063031},"lastCommittedPoint":null,"startArrowhead":null,"endArrowhead":"arrow","points":[[0,0],[-1.7237290650041075,82.42245370370368]],"index":"a4","frameId":null},{"type":"arrow","version":2605,"versionNonce":840822964,"isDeleted":false,"id":"qK2BSuTEqi8ZAs2thpmmC","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":1,"opacity":100,"angle":0,"x":260.03372492207217,"y":16.22222222222223,"strokeColor":"#000000","backgroundColor":"transparent","width":0.21795372114019074,"height":80.9189814814815,"seed":193869970,"groupIds":[],"roundness":{"type":2},"boundElements":[],"updated":1734707177401,"link":null,"locked":false,"startBinding":{"elementId":"74zfclxf7kyjGoTB4x5Jn","gap":2.2222222222222223,"focus":0.07938802468499777},"endBinding":{"elementId":"GgZCPi-Ftl_nRy9voleLb","gap":2.858796296296296,"focus":0.4700791974583939},"lastCommittedPoint":null,"startArrowhead":null,"endArrowhead":"arrow","points":[[0,0],[0.21795372114019074,80.9189814814815]],"index":"a5","frameId":null},{"type":"rectangle","version":239,"versionNonce":855518772,"isDeleted":false,"id":"i_emLgJ9-b3uXTpLd63N6","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":1,"opacity":100,"angle":0,"x":-122.25,"y":-58.15625,"strokeColor":"#000000","backgroundColor":"#ced4da","width":178,"height":60,"seed":572347986,"groupIds":[],"roundness":{"type":3},"boundElements":[{"type":"text","id":"XzB00LSM"}],"updated":1734707177209,"link":null,"locked":false,"index":"a6","frameId":null},{"type":"text","version":177,"versionNonce":636092172,"isDeleted":false,"id":"XzB00LSM","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":1,"opacity":100,"angle":0,"x":-113.70991516113281,"y":-40.65625,"strokeColor":"#000000","backgroundColor":"transparent","width":160.91983032226562,"height":25,"seed":516788434,"groupIds":[],"roundness":null,"boundElements":[],"updated":1734707177209,"link":null,"locked":false,"fontSize":20,"fontFamily":1,"text":"cache: A=1; B=0;","rawText":"cache: A=1; B=0;","textAlign":"center","verticalAlign":"middle","containerId":"i_emLgJ9-b3uXTpLd63N6","originalText":"cache: A=1; B=0;","lineHeight":1.25,"baseline":18,"autoResize":true,"index":"a7","frameId":null},{"type":"rectangle","version":377,"versionNonce":84035508,"isDeleted":false,"id":"74zfclxf7kyjGoTB4x5Jn","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":1,"opacity":100,"angle":0,"x":160,"y":-100,"strokeColor":"#000000","backgroundColor":"transparent","width":217,"height":114,"seed":1552071698,"groupIds":[],"roundness":{"type":3},"boundElements":[{"type":"text","id":"x8CFQFy4"},{"id":"qK2BSuTEqi8ZAs2thpmmC","type":"arrow"}],"updated":1734707177209,"link":null,"locked":false,"index":"a8","frameId":null},{"type":"text","version":351,"versionNonce":2028879244,"isDeleted":false,"id":"x8CFQFy4","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":1,"opacity":100,"angle":0,"x":214.44005584716797,"y":-95,"strokeColor":"#000000","backgroundColor":"transparent","width":108.11988830566406,"height":25,"seed":2025155026,"groupIds":[],"roundness":null,"boundElements":[],"updated":1734707177209,"link":null,"locked":false,"fontSize":20,"fontFamily":1,"text":"CPU Core2","rawText":"CPU Core2","textAlign":"center","verticalAlign":"top","containerId":"74zfclxf7kyjGoTB4x5Jn","originalText":"CPU Core2","lineHeight":1.25,"baseline":18,"autoResize":true,"index":"a9","frameId":null},{"type":"rectangle","version":332,"versionNonce":38220084,"isDeleted":false,"id":"EwK9n6v89S-EJfbMWgdz3","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":1,"opacity":100,"angle":0,"x":172.75,"y":-56.15625,"strokeColor":"#000000","backgroundColor":"#ced4da","width":182,"height":60,"seed":1573674898,"groupIds":[],"roundness":{"type":3},"boundElements":[{"type":"text","id":"s8nU81Eq"}],"updated":1734707177209,"link":null,"locked":false,"index":"aA","frameId":null},{"type":"text","version":308,"versionNonce":233221132,"isDeleted":false,"id":"s8nU81Eq","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":1,"opacity":100,"angle":0,"x":178.88008880615234,"y":-38.65625,"strokeColor":"#000000","backgroundColor":"transparent","width":169.7398223876953,"height":25,"seed":2013175122,"groupIds":[],"roundness":null,"boundElements":[],"updated":1734707177209,"link":null,"locked":false,"fontSize":20,"fontFamily":1,"text":"cache: A=0; B=2;","rawText":"cache: A=0; B=2;","textAlign":"center","verticalAlign":"middle","containerId":"EwK9n6v89S-EJfbMWgdz3","originalText":"cache: A=0; B=2;","lineHeight":1.25,"baseline":18,"autoResize":true,"index":"aB","frameId":null},{"type":"text","version":178,"versionNonce":707979956,"isDeleted":false,"id":"GMcQpra9","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":1,"opacity":100,"angle":0,"x":480,"y":-80,"strokeColor":"#000000","backgroundColor":"#ced4da","width":129.90625,"height":216,"seed":346235666,"groupIds":[],"roundness":null,"boundElements":[],"updated":1734707177209,"link":null,"locked":false,"fontSize":20,"fontFamily":3,"text":"A=0; B=0;\n\n// thread 1\nA = 1;\nprint(B);\n\n// thread 2\nB = 2;\nprint(A);","rawText":"A=0; B=0;\n\n// thread 1\nA = 1;\nprint(B);\n\n// thread 2\nB = 2;\nprint(A);","textAlign":"left","verticalAlign":"top","containerId":null,"originalText":"A=0; B=0;\n\n// thread 1\nA = 1;\nprint(B);\n\n// thread 2\nB = 2;\nprint(A);","lineHeight":1.2,"baseline":211,"autoResize":true,"index":"aC","frameId":null}],"appState":{"theme":"light","viewBackgroundColor":"#ffffff","currentItemStrokeColor":"#000000","currentItemBackgroundColor":"#ced4da","currentItemFillStyle":"hachure","currentItemStrokeWidth":1,"currentItemStrokeStyle":"solid","currentItemRoughness":1,"currentItemOpacity":100,"currentItemFontFamily":3,"currentItemFontSize":20,"currentItemTextAlign":"left","currentItemStartArrowhead":null,"currentItemEndArrowhead":"arrow","currentItemArrowType":"round","scrollX":200.78694331029976,"scrollY":308.3649997486985,"zoom":{"value":1},"currentItemRoundness":"round","gridSize":20,"gridStep":5,"gridModeEnabled":true,"gridColor":{"Bold":"rgba(217, 217, 217, 0.5)","Regular":"rgba(230, 230, 230, 0.5)"},"colorPalette":{},"currentStrokeOptions":null,"frameRendering":{"enabled":true,"clip":true,"name":true,"outline":true},"objectsSnapModeEnabled":false,"activeTool":{"type":"selection","customType":null,"locked":false,"lastActiveTool":null}},"files":{}};InitialData.scrollToContent=true;App=()=>{const e=React.useRef(null),t=React.useRef(null),[n,i]=React.useState({width:void 0,height:void 0});return React.useEffect(()=>{i({width:t.current.getBoundingClientRect().width,height:t.current.getBoundingClientRect().height});const e=()=>{i({width:t.current.getBoundingClientRect().width,height:t.current.getBoundingClientRect().height})};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[t]),React.createElement(React.Fragment,null,React.createElement("div",{className:"excalidraw-wrapper",ref:t},React.createElement(ExcalidrawLib.Excalidraw,{ref:e,width:n.width,height:n.height,initialData:InitialData,viewModeEnabled:!0,zenModeEnabled:!0,gridModeEnabled:!1})))},excalidrawWrapper=document.getElementById("cache-coherencyexcalidraw.md1");ReactDOM.render(React.createElement(App),excalidrawWrapper);})();</script>

正常理解，无论线程1，2的执行顺序如何，最后不可能出现打印出0，0的情况。但是在这种情况下，如果各自都从缓存中读数据，那就可能出现0，0的情况。这也进一步引出了[volatile](202304202149volatile-specifier)关键字[[__zettel/202304202149volatile-specifier\|volatile wiki link]]。


Sequential Consistency
-----------------------------------------

顺序一致性，是一致性最严格的内存模型，他有两条要求：

1. 每个处理器的执行顺序和代码的执行顺序一致
2. 处理器并行执行的结果要和处理器按照某种顺序执行的结果一致



Memory barrier
----------------------------

即内存栅栏。为什么需要内存栅栏？


| memory_order | 解释 | 
|  -- | -- |
| memory_order_acquire | 所有内存操作必须在我这个load之后 | 
| memory_order_release | 所有内存操作必须在我这个release之前 | 



有两个因素会影响执行顺序：

- 编译器优化，重排
- 处理器乱序
    - ARM 和 Alpha 更为松散
    - 即使 Intel 处理器仍有乱序


在c++98里，我们没有一种机制能够告诉c++编译器，我们在某个代码块不希望乱序。我们不可能阻止所有乱序，但在多线程同步场合下，我们确实需要保证顺序。

acquire、release语义

解决通过单个原子量进行同步的场景。

acquire指的是，我在这里做了一个原子读操作，我要求在我后面的所有读操作不允许重排到我前面去。

relase说的是，我这儿做了个原子写操作，我要求在我前面的写操作不允许重排到我后面去。


这两个配合使用可以做到两个线程间的同步！假设线程A store an atmoic variable using memory_order_release，线程B load the same atomic variable using memory_order_acquire.

根据acquire和release的语义，线程A中所有发生在atomic store之前的内存写（包括非原子的和松弛原子【memory_order_relaxed】的），在线程B中将变得可见。也就是说，当线程B atmoic load之后且load到的值确实是线程A写入的那个值，则B能够保证看到everything thread A wrote to memory.

这个同步仅仅存在于load with acuqire, store with release, on the same atomic variable的任意两个线程之间。其他线程不保证。

Mutual exclusion locks, such as [std::mutex](https://en.cppreference.com/w/cpp/thread/mutex "cpp/thread/mutex") or [atomic spinlock](https://en.cppreference.com/w/cpp/atomic/atomic_flag "cpp/atomic/atomic flag"), are an example of release-acquire synchronization: when the lock is released by thread A and acquired by thread B, everything that took place in the critical section (before the release) in the context of thread A has to be visible to thread B (after the acquire) which is executing the same critical section.

<div id="202305161028内存模型-202306291048excalidraw.md2"></div><script>(function(){const InitialData={"type":"excalidraw","version":2,"source":"https://github.com/zsviczian/obsidian-excalidraw-plugin/releases/tag/2.7.1","elements":[{"id":"m_y3yqXpn9gyInpowwCrv","type":"rectangle","x":-420,"y":-80,"width":340,"height":302,"angle":0,"strokeColor":"#000000","backgroundColor":"transparent","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":1,"opacity":100,"groupIds":[],"roundness":{"type":3},"seed":1124802156,"version":84,"versionNonce":1860841100,"isDeleted":false,"boundElements":[{"type":"text","id":"LsvvuRLU"}],"updated":1734705933725,"link":null,"locked":false,"index":"a0","frameId":null},{"id":"LsvvuRLU","type":"text","x":-297.015625,"y":-75,"width":94.03125,"height":24,"angle":0,"strokeColor":"#000000","backgroundColor":"transparent","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":1,"opacity":100,"groupIds":[],"roundness":null,"seed":72567764,"version":69,"versionNonce":1862193204,"isDeleted":false,"boundElements":[],"updated":1734705933725,"link":null,"locked":false,"text":"thread A","rawText":"thread A","fontSize":20,"fontFamily":3,"textAlign":"center","verticalAlign":"top","baseline":19,"containerId":"m_y3yqXpn9gyInpowwCrv","originalText":"thread A","lineHeight":1.2,"autoResize":true,"index":"a1","frameId":null},{"id":"EaLfjD5E","type":"text","x":-40,"y":-200,"width":164.0625,"height":24,"angle":0,"strokeColor":"#000000","backgroundColor":"transparent","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":1,"opacity":100,"groupIds":[],"roundness":null,"seed":693974764,"version":46,"versionNonce":557612300,"isDeleted":false,"boundElements":[],"updated":1734705933725,"link":null,"locked":false,"text":"atomic<int> x;","rawText":"atomic<int> x;","fontSize":20,"fontFamily":3,"textAlign":"left","verticalAlign":"top","baseline":19,"containerId":null,"originalText":"atomic<int> x;","lineHeight":1.2,"autoResize":true,"index":"a2","frameId":null},{"type":"rectangle","version":120,"versionNonce":2090772916,"isDeleted":false,"id":"yL6F1uRJ8rIZzFUZjlI6A","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":1,"opacity":100,"angle":0,"x":-20,"y":-80,"strokeColor":"#000000","backgroundColor":"transparent","width":520,"height":302,"seed":1124802156,"groupIds":[],"roundness":{"type":3},"boundElements":[{"type":"text","id":"tPg2MLwk"}],"updated":1734705933725,"link":null,"locked":false,"index":"a3","frameId":null},{"type":"text","version":107,"versionNonce":557906828,"isDeleted":false,"id":"tPg2MLwk","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":1,"opacity":100,"angle":0,"x":192.984375,"y":-75,"strokeColor":"#000000","backgroundColor":"transparent","width":94.03125,"height":24,"seed":72567764,"groupIds":[],"roundness":null,"boundElements":[],"updated":1734705933725,"link":null,"locked":false,"fontSize":20,"fontFamily":3,"text":"thread B","rawText":"thread B","textAlign":"center","verticalAlign":"top","containerId":"yL6F1uRJ8rIZzFUZjlI6A","originalText":"thread B","lineHeight":1.2,"baseline":19,"autoResize":true,"index":"a4","frameId":null},{"id":"AzajFeco","type":"text","x":-400,"y":1.7763568394002505e-15,"width":309.375,"height":96,"angle":0,"strokeColor":"#000000","backgroundColor":"transparent","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":1,"opacity":100,"groupIds":[],"roundness":null,"seed":2110611540,"version":123,"versionNonce":1275548468,"isDeleted":false,"boundElements":[],"updated":1734705933725,"link":null,"locked":false,"text":"// dome \n// some \n// write\n\nx.store(23, memory_order_realse);","rawText":"// dome \n// some \n// write\n\nx.store(23, memory_order_realse);","fontSize":16,"fontFamily":3,"textAlign":"left","verticalAlign":"top","baseline":92,"containerId":null,"originalText":"// dome \n// some \n// write\n\nx.store(23, memory_order_realse);","lineHeight":1.2,"autoResize":true,"index":"a5","frameId":null},{"id":"xwlSwItr","type":"text","x":20,"y":20,"width":478.125,"height":96,"angle":0,"strokeColor":"#000000","backgroundColor":"transparent","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":1,"opacity":100,"groupIds":[],"roundness":null,"seed":424746732,"version":226,"versionNonce":1496427020,"isDeleted":false,"boundElements":[],"updated":1734705933725,"link":null,"locked":false,"text":"if (x.load(memory_order_acquire) == 23) {\n    // at this point, all writes in A\n    // before x.store(23, memory_order_release)\n    // is visible in B.\n}","rawText":"if (x.load(memory_order_acquire) == 23) {\n    // at this point, all writes in A\n    // before x.store(23, memory_order_release)\n    // is visible in B.\n}","fontSize":16,"fontFamily":3,"textAlign":"left","verticalAlign":"top","baseline":92,"containerId":null,"originalText":"if (x.load(memory_order_acquire) == 23) {\n    // at this point, all writes in A\n    // before x.store(23, memory_order_release)\n    // is visible in B.\n}","lineHeight":1.2,"autoResize":true,"index":"a6","frameId":null},{"id":"fIrIUYcdWX2t8_vJHSpFl","type":"line","x":-420,"y":120,"width":340,"height":0,"angle":0,"strokeColor":"#000000","backgroundColor":"transparent","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":1,"opacity":100,"groupIds":[],"roundness":{"type":2},"seed":675984212,"version":29,"versionNonce":1268698292,"isDeleted":false,"boundElements":[],"updated":1734705933725,"link":null,"locked":false,"points":[[0,0],[340,0]],"lastCommittedPoint":null,"startBinding":null,"endBinding":null,"startArrowhead":null,"endArrowhead":null,"index":"a7","frameId":null},{"type":"line","version":44,"versionNonce":1544063116,"isDeleted":false,"id":"WP-6_Ta-cRa7Lbi-c0xBd","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":1,"opacity":100,"angle":0,"x":-419.43526566177604,"y":-18.90875959247351,"strokeColor":"#000000","backgroundColor":"transparent","width":340,"height":0,"seed":675984212,"groupIds":[],"roundness":{"type":2},"boundElements":[],"updated":1734705933725,"link":null,"locked":false,"startBinding":null,"endBinding":null,"lastCommittedPoint":null,"startArrowhead":null,"endArrowhead":null,"points":[[0,0],[340,0]],"index":"a8","frameId":null},{"id":"XEohCeTZdHTX2UqGjYFEJ","type":"line","x":-20,"y":40,"width":520,"height":0,"angle":0,"strokeColor":"#873184","backgroundColor":"transparent","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":1,"opacity":100,"groupIds":[],"roundness":{"type":2},"seed":136541420,"version":49,"versionNonce":755701300,"isDeleted":false,"boundElements":[],"updated":1734705933725,"link":null,"locked":false,"points":[[0,0],[520,0]],"lastCommittedPoint":null,"startBinding":null,"endBinding":null,"startArrowhead":null,"endArrowhead":null,"index":"a9","frameId":null},{"id":"1aYgM6dvWJzQwvJ1WFrf6","type":"line","x":-80,"y":-20,"width":60,"height":60,"angle":0,"strokeColor":"#000000","backgroundColor":"transparent","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"dashed","roughness":1,"opacity":100,"groupIds":[],"roundness":{"type":2},"seed":1711447508,"version":17,"versionNonce":1300207372,"isDeleted":false,"boundElements":[],"updated":1734705933725,"link":null,"locked":false,"points":[[0,0],[60,60]],"lastCommittedPoint":null,"startBinding":null,"endBinding":null,"startArrowhead":null,"endArrowhead":null,"index":"aA","frameId":null},{"id":"kKQUvKDVN8l0MAQGefbNH","type":"line","x":-80.4501079544425,"y":120.03893110603094,"width":60,"height":80,"angle":0,"strokeColor":"#000000","backgroundColor":"transparent","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"dashed","roughness":1,"opacity":100,"groupIds":[],"roundness":{"type":2},"seed":948879596,"version":45,"versionNonce":2100441012,"isDeleted":false,"boundElements":[],"updated":1734705933725,"link":null,"locked":false,"points":[[0,0],[60,80]],"lastCommittedPoint":null,"startBinding":null,"endBinding":null,"startArrowhead":null,"endArrowhead":null,"index":"aB","frameId":null}],"appState":{"theme":"light","viewBackgroundColor":"#ffffff","currentItemStrokeColor":"#000000","currentItemBackgroundColor":"transparent","currentItemFillStyle":"hachure","currentItemStrokeWidth":1,"currentItemStrokeStyle":"dashed","currentItemRoughness":1,"currentItemOpacity":100,"currentItemFontFamily":3,"currentItemFontSize":16,"currentItemTextAlign":"left","currentItemStartArrowhead":null,"currentItemEndArrowhead":"arrow","currentItemArrowType":"round","scrollX":444.80592444144565,"scrollY":371.93113817471055,"zoom":{"value":1},"currentItemRoundness":"round","gridSize":20,"gridStep":5,"gridModeEnabled":true,"gridColor":{"Bold":"rgba(217, 217, 217, 0.5)","Regular":"rgba(230, 230, 230, 0.5)"},"colorPalette":{},"currentStrokeOptions":null,"frameRendering":{"enabled":true,"clip":true,"name":true,"outline":true},"objectsSnapModeEnabled":false,"activeTool":{"type":"selection","customType":null,"locked":false,"lastActiveTool":null}},"files":{}};InitialData.scrollToContent=true;App=()=>{const e=React.useRef(null),t=React.useRef(null),[n,i]=React.useState({width:void 0,height:void 0});return React.useEffect(()=>{i({width:t.current.getBoundingClientRect().width,height:t.current.getBoundingClientRect().height});const e=()=>{i({width:t.current.getBoundingClientRect().width,height:t.current.getBoundingClientRect().height})};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[t]),React.createElement(React.Fragment,null,React.createElement("div",{className:"excalidraw-wrapper",ref:t},React.createElement(ExcalidrawLib.Excalidraw,{ref:e,width:n.width,height:n.height,initialData:InitialData,viewModeEnabled:!0,zenModeEnabled:!0,gridModeEnabled:!1})))},excalidrawWrapper=document.getElementById("202305161028内存模型-202306291048excalidraw.md2");ReactDOM.render(React.createElement(App),excalidrawWrapper);})();</script>

内存屏障：[内核文档](https://github.com/torvalds/linux/blob/master/Documentation/memory-barriers.txt)
